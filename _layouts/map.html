<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  {% include head.html %}

  <body>

    {% include header.html %}

    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="/assets/js/datamaps.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js"></script>

    <main class="page-content" aria-label="Content">

      <div id="container" style="position: relative; height: 750px;"></div>
      <script>
       var map = new Datamap({
         element: document.getElementById('container'),
         geographyConfig: {
           dataUrl: '/assets/topo/europe.json',
           popupTemplate: function(geo, data) {
             return ['<div class="hoverinfo"><strong>',
                     '<h3>' + geo.properties.name + '</h3>',
                     'Some data ',
                     ': ' + data.numberOfThings,
                     '</strong></div>'].join('');
           }
         },
         scope: 'europe',
         setProjection: function(element, options) {
           var projection = d3.geo.albers()
                              .center([10, 55.4])
                              .rotate([0, 0])
                              .parallels([50, 60])
                              .scale(1000)
                              .translate([element.offsetWidth / 2, element.offsetHeight / 2]);
           var path =  d3.geo.path()
                         .projection(projection);
           return {path: path, projection: projection};
         },
         fills: {
           good: 'green',
           bad: 'red',
           medium: 'blue',
           UNKNOWN: 'rgb(0,0,0)',
           defaultFill: 'grey'
         }
       });

       var publicSpreadsheetUrl = " {{page.spreadsheet}} ";

       function init() {
         Tabletop.init( { key: publicSpreadsheetUrl,
                          callback: updateInfo,
                          simpleSheet: true } )
       }

       function updateInfo(data, tabletop) {
         console.log(data);
         for(var i=0; i < data.length; i++){
           var obj = {}
           obj[data[i].country] = {fillKey: data[i].state, numberOfThings: data[i].data}
           map.updateChoropleth(obj);
         }
       }
       window.addEventListener('DOMContentLoaded', init)
      </script>
    </main>

    {% include footer.html %}

  </body>

</html>
